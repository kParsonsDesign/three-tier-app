<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Users (Formatted)</title>

  <!-- Bootstrap CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

  <!-- Superagent - small, client-side HTTP request library -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=WeakRef,BigInt"></script>
  <script src="https://cdn.jsdelivr.net/npm/superagent"></script>

  <!-- Add External HTML Files -->
  <script>
    function includeHTML() {
      var z, i, elmnt, file, xhttp;
      /* Loop through a collection of all HTML elements: */
      z = document.getElementsByTagName("*");
      for (i = 0; i < z.length; i++) {
        elmnt = z[i];
        /*search for elements with a certain atrribute:*/
        file = elmnt.getAttribute("w3-include-html");
        if (file) {
          /* Make an HTTP request using the attribute value as the file name: */
          xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4) {
              if (this.status == 200) {elmnt.innerHTML = this.responseText;}
              if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
              /* Remove the attribute, and call this function once more: */
              elmnt.removeAttribute("w3-include-html");
              includeHTML();
            }
          }
          xhttp.open("GET", file, true);
          xhttp.send();
          /* Exit the function: */
          return;
        }
      }
    }
  </script>
  <link rel="stylesheet" href="style.css">

</head>
<body>
  <!-- Nav Bar -->
  <div w3-include-html="nav.html"></div>

  <main role="main" class="container-flex mt-3 p-3">
    <h1 class="m-3 fw-light">All Users</h1>
    <div class="grid-container" id="allUsers"></div>
  </main>
  
  
</body>
<!-- Include External HTML Files -->
<script>
  includeHTML();
</script>

<script>
  function data() {
    const usersDiv = document.getElementById('allUsers')
    const url = '/users'
    let html = ''

    superagent
      .get(url)
      .end(function(err,res){
        if(err){
          console.log(err)
        }
        else{
          console.log(res)
          res.body.forEach((user, index) => {
            html += `
              <div class="card mx-1">
                <img class="rounded-circle m-2 mx-auto" style="width:6rem;height:6rem;" src="${user.avatar}" alt="Avatar for ${user.fullName}" />
                <div class="card-body">
                  <div class="text-center">
                    <h5 class="card-title fw-semibold">${user.fullName}</h5>
                    <p class="fw-light" style="font-size:0.85rem">${user.email}</p>
                  </div>
                  <p class="card-text" style="">
                    <span class="fw-light">DOB:</span> ${new Date(user.dob).toLocaleDateString()}<br />
                    <span class="fw-light">Username:</span><br />
                      <span class="ms-3">${user.username}</span><br />
                    <span class="fw-light">Phone:</span><br />
                      <span class="ms-3">${user.phone}</span><br />
                    <a class="btn w-100 m-0 p-1" data-bs-toggle="collapse" href="#collapse${index}" role="button" aria-expanded="false" aria-controls="collapse${index}" style="position:relative;left:-0.2rem;"><span class="fw-light" style="float:left">Address:</span> 
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="float:right; margin-top:0.5rem" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                      </svg></a>
                      <span class="collapse m-0" id="collapse${index}">
                        <span class="d-inline-block ms-3">${user.streetaddress}<br />
                        ${user.citystatezip}</span>
                      </span>
                    <span class="fw-light">Latitude:</span> ${user.latitude}<br />
                    <span class="fw-light">Longitude:</span> ${user.longitude}<br />
                  </p>
                </div>
              </div>
            `
            // let card = document.createElement('div')
            // card.className = card
            // card.style = 'width: 10rem'

            // let img = document.createElement('img')
            // img.className = card-img-top
            // img.alt = `Avatar for ${user.fullName}`
            // img.src = user.avatar
            // card.appendChild(img)

            // let info = document.createElement('div')
            // info.className = card-body
            // card.appendChild(info)

          })
          usersDiv.innerHTML = html
        }
      })
  }
  data()
</script>

<!-- Bootstrap JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
