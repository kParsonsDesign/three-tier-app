<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add User</title>

  <!-- Bootstrap CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

  <!-- Superagent - small, client-side HTTP request library -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=WeakRef,BigInt"></script>
  <script src="https://cdn.jsdelivr.net/npm/superagent"></script>

  <!-- Add External HTML Files -->
  <script>
    function includeHTML() {
      var z, i, elmnt, file, xhttp;
      /* Loop through a collection of all HTML elements: */
      z = document.getElementsByTagName("*");
      for (i = 0; i < z.length; i++) {
        elmnt = z[i];
        /*search for elements with a certain atrribute:*/
        file = elmnt.getAttribute("w3-include-html");
        if (file) {
          /* Make an HTTP request using the attribute value as the file name: */
          xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4) {
              if (this.status == 200) {elmnt.innerHTML = this.responseText;}
              if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
              /* Remove the attribute, and call this function once more: */
              elmnt.removeAttribute("w3-include-html");
              includeHTML();
            }
          }
          xhttp.open("GET", file, true);
          xhttp.send();
          /* Exit the function: */
          return;
        }
      }
    }
  </script>

  <!-- <script type="module" src="/addUser.js"></script> -->
</head>
<body>
  <!-- Nav Bar -->
  <div w3-include-html="nav.html"></div>

  <main role="main" class="container mt-3">
    <h1>Add User</h1>

    <!-- User Interface -->
    <div>
      <!-- <form action="/add" method="post" target="#status" onsubmit="addUser()"> -->
        <button id="addUserButton" type="button" class="btn btn-primary">Add Random User</button>
      <!-- </form> -->
    </div>
    <div id="status"></div>
  </main>
  
  
</body>
<!-- Include External HTML Files -->
<script>
  includeHTML();
</script>

<script>
document.getElementById('addUserButton').addEventListener('click', addUser)
function addUser(e) {
  e.preventDefault()
  console.log(e)
  superagent
    .post('/add')
    .end(function(err,res){
      if(err){
        console.log(err)
      }
      else{
        console.log(res)
        if(res.statusCode === 200){
          // let message = `
          // <b>Response: Satatus Code 200.</b>
          // The HTTP 200 OK Success status
          // response code indicates that the HTTP request has succeeded.<br />
          // User: ${fullName}<br />
          // ${new Date()}
          // `
          // return message
          document.getElementById('status').
          innerHTML = `
            <b>Response: Satatus Code 200.</b><br />
            The HTTP 200 OK Success status
            response code indicates that the HTTP request has succeeded.<br />
            <h5 class="mt-3">New User Created</h5>
            User: ${res.body.fullName}<br />
            Created at: ${new Date()}
            `
        }
      }
    })
}

</script>
